// ==UserScript==
// @name         Coconut Shy Mobile Friendly
// @namespace    https://github.com/unoriginality786/
// @version      1.0
// @description  Convert text to be readable and add a refresh button
// @match        https://www.neopets.com/halloween/process_cocoshy.phtml?coconut=*
// @grant        GM_addStyle
// ==/UserScript==

(function () {
    'use strict';

    GM_addStyle(`
        @font-face {
            font-family: 'Heffaklump';
            src: url('https://raw.githubusercontent.com/unoriginality786/Neopets_Dailies/main/fonts/Heffaklump.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }

        body {
            font-family: 'Heffaklump', sans-serif;
            background-color: #fdf6ec;
            padding: 20px;
            margin: 0;
        }

        .coconut-message {
            text-align: center;
            font-size: 1.8em;
            color: #5a2b7b;
            margin-bottom: 20px;
        }

        .button-default__2020 {
            padding: 2px 5px 7px 5px !important;
            border-radius: 12px;
            min-height: 25px;
            cursor: pointer;
            border: none;
            color: #fff;
            background-color: #8e44ad;
            font-size: 1.1em;
            font-family: 'Heffaklump', sans-serif;
            transition: background-color 0.2s ease-in-out;
        }

        .button-default__2020:hover {
            background-color: #732d91;
        }

        .custom-button-wrapper {
            text-align: center;
        }

        .custom-button-wrapper button {
            width: 50%;
        }
    `);

    let rawText = document.body.textContent || '';
    const errorMatch = rawText.match(/&error=(.*)/);

    if (errorMatch && errorMatch[1]) {
        const decodedMessage = decodeURIComponent(errorMatch[1].replace(/\+/g, ' '));

        document.body.innerHTML = '';

        const messageDiv = document.createElement('div');
        messageDiv.textContent = decodedMessage;
        messageDiv.className = 'coconut-message';
        document.body.appendChild(messageDiv);

        const buttonWrapper = document.createElement('div');
        buttonWrapper.className = 'custom-button-wrapper';

        const button = document.createElement('button');
        button.textContent = 'Refresh Page';
        button.classList.add('button-default__2020');
        button.onclick = () => location.reload();

        buttonWrapper.appendChild(button);
        document.body.appendChild(buttonWrapper);
    }
})();
