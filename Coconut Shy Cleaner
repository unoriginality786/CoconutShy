// ==UserScript==
// @name         Coconut Shy Mobile Friendly
// @namespace    http://tampermonkey.net/
// @version      1.3
// @description  Convert text to be readable and add refresh button
// @match        https://www.neopets.com/halloween/process_cocoshy.phtml?coconut=*
// @grant        GM_addStyle
// ==/UserScript==

(function () {
    'use strict';

    // Add custom font and styles
    GM_addStyle(`
        @font-face {
            font-family: 'Heffaklump';
            src: url('https://raw.githubusercontent.com/unoriginality786/Neopets_Dailies/main/fonts/Heffaklump.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }

        body {
            font-family: 'Heffaklump', sans-serif;
            background-color: #fdf6ec;
            padding: 20px;
            margin: 0;
        }

        .coconut-message {
            text-align: center;
            font-size: 1.8em;
            color: #5a2b7b;
            margin-bottom: 20px;
        }

        .button-default__2020 {
            padding: 2px 5px 7px 5px !important;
            border-radius: 12px;
            min-height: 25px;
            cursor: pointer;
            border: none;
            color: #fff;
            background-color: #8e44ad;
            font-size: 1.1em;
            font-family: 'Heffaklump', sans-serif;
            transition: background-color 0.2s ease-in-out;
        }

        .button-default__2020:hover {
            background-color: #732d91;
        }

        .custom-button-wrapper {
            text-align: center;
        }

        .custom-button-wrapper button {
            width: 50%;
        }
    `);

    // Get the raw text content from the page
    let rawText = document.body.textContent || '';
    const errorMatch = rawText.match(/&error=(.*)/);

    if (errorMatch && errorMatch[1]) {
        const decodedMessage = decodeURIComponent(errorMatch[1].replace(/\+/g, ' '));

        // Clear the body
        document.body.innerHTML = '';

        // Create and insert message
        const messageDiv = document.createElement('div');
        messageDiv.textContent = decodedMessage;
        messageDiv.className = 'coconut-message';
        document.body.appendChild(messageDiv);

        // Create and insert button inside wrapper for centering
        const buttonWrapper = document.createElement('div');
        buttonWrapper.className = 'custom-button-wrapper';

        const button = document.createElement('button');
        button.textContent = 'Throw again';
        button.classList.add('button-default__2020');
        button.style.display = 'inline-block';
        button.style.padding = '8px 14px';
        button.style.width = 'auto';

        // Check if user is out of throws
        if (decodedMessage.trim() === "Oi! No more throws, you've had yer lot.") {
            button.style.backgroundColor = '#e74c3c'; // red
            button.disabled = true;
            button.style.cursor = 'not-allowed';
            button.title = "No more throws available";
        } else {
            button.onclick = () => location.reload();
        }

        buttonWrapper.appendChild(button);
        document.body.appendChild(buttonWrapper);
    }
})();
